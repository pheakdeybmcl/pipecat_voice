<include>
  <extension name="test_0000000000">
    <condition field="destination_number" expression="^0000000000$">
      <action application="answer"/>

      <action application="set" data="hangup_after_playback=false"/>
      <action application="set" data="media_timeout=0"/>
      <action application="set" data="media_hold_timeout=0"/>
      <action application="set" data="rtp_timeout_sec=0"/>
      <action application="set" data="rtp_hold_timeout_sec=0"/>
      <action application="set" data="session_timeout=0"/>
      <action application="set" data="send_silence_when_idle=true"/>
      <action application="set" data="rtp_keepalive=5"/>
      <action application="set" data="hold_music=local_stream://silence"/>
      <action application="set" data="ringback=local_stream://silence"/>

      <action application="set" data="STREAM_SUPPRESS_LOG=true"/>
      <action application="set" data="STREAM_BUFFER_SIZE=20"/>

      <!-- DTMF language selection handled in FreeSWITCH -->
      <action application="set" data="lang=en"/>
      <action application="play_and_get_digits" data="1 1 3 10000 # /usr/local/freeswitch/share/freeswitch/sounds/custom/ivr_lang_prompt.wav /usr/local/freeswitch/share/freeswitch/sounds/custom/ivr_lang_prompt.wav lang_digit ^[123]$"/>
      <action application="set" data="lang=${if(${lang_digit}==2?km:en)}"/>
      <action application="set" data="lang=${if(${lang_digit}==3?hi:${lang})}"/>

      <!-- Start audio stream with selected language -->
      <action application="set" data="api_result=${bgapi(uuid_audio_stream ${uuid} start ws://192.168.1.31:8000/ws_fs?session_id=${uuid}&lang=${lang} mono 16k)}"/>
      <action application="endless_playback" data="silence_stream://-1"/>
    </condition>
  </extension>
</include>
